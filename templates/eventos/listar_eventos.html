{% extends "base.html" %}
{% block title %}Listado de eventos{% endblock %}

{% block content %}
  <h2>Eventos registrados</h2>
  <p>Aquí puedes ver todos los eventos a los que tienes acceso.</p>

  {% if eventos %}
    <table style="width:100%;border-collapse:collapse;margin-top:1rem;">
      <thead>
        <tr>
          <th style="border-bottom:1px solid #e5e7eb;text-align:left;padding:.5rem;">Nombre</th>
          <th style="border-bottom:1px solid #e5e7eb;text-align:left;padding:.5rem;">Fecha</th>
          <th style="border-bottom:1px solid #e5e7eb;text-align:left;padding:.5rem;">Ubicación</th>
          <th style="border-bottom:1px solid #e5e7eb;text-align:left;padding:.5rem;">Privado</th>
          <th style="border-bottom:1px solid #e5e7eb;text-align:left;padding:.5rem;">Participantes</th>
          <th style="border-bottom:1px solid #e5e7eb;text-align:left;padding:.5rem;">Acciones</th>
        </tr>
      </thead>
      <tbody>
        {% for e in eventos %}
          <tr>
            <td style="padding:.5rem;">
              <a href="{% url 'eventos:detalle' e.pk %}" style="text-decoration:none;color:#111827;">
                {{ e.nombre }}
              </a>
            </td>
            <td style="padding:.5rem;">{{ e.fecha }}</td>
            <td style="padding:.5rem;">{{ e.ubicacion|default:"-" }}</td>
            <td style="padding:.5rem;">
              {{ e.es_privado|yesno:"Sí,No" }}
            </td>
            <td style="padding:.5rem;">
              {{ e.participantes.count }}
            </td>
            <td style="padding:.5rem;white-space:nowrap;">
              <a href="{% url 'eventos:detalle' e.pk %}">Ver detalle</a>

              {% if request.user.is_authenticated %}
                {% if request.user.is_superuser or e.propietario_id == request.user.id %}
                  | <a href="{% url 'eventos:editar' e.pk %}">Editar</a>
                  | <a href="{% url 'eventos:eliminar' e.pk %}">Eliminar</a>
                {% endif %}
              {% endif %}
            </td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  {% else %}
    <p>No hay eventos registrados.</p>
  {% endif %}

  <div style="margin-top:1.5rem;display:flex;gap:.5rem;flex-wrap:wrap;">
    {% if request.user.is_authenticated %}
      <a href="{% url 'eventos:registrar' %}" class="btn">+ Registrar nuevo evento</a>
    {% else %}
      <a href="{% url 'login' %}" class="btn">Inicia sesión para crear eventos</a>
    {% endif %}
    <a href="{% url 'home' %}" class="btn">Volver al inicio</a>
  </div>
{% endblock %}
